<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Calculator</title>
    <style>
        /* --- 1. Flexbox Layout & General --- */
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;

            /* CSS ข้อ 1: Container หลักเป็น Flex column */
            display: flex;
            flex-direction: column;
            gap: 15px;
            /* ระยะห่างระหว่างแต่ละก้อน */
        }

        h2 {
            text-align: center;
            margin-top: 0;
            color: #333;
        }

        /* CSS ข้อ 1: Input rows จัดด้วย Flexbox */
        .input-row {
            display: flex;
            align-items: center;
            /* จัดกึ่งกลางแนวตั้ง */
            justify-content: space-between;
            gap: 10px;
        }

        .input-row label {
            flex: 1;
            /* label กินพื้นที่ 1 ส่วน */
            font-weight: bold;
            font-size: 14px;
        }

        .input-wrapper {
            flex: 2;
            /* input กินพื้นที่ 2 ส่วน (กว้างกว่า label) */
        }

        /* --- 2. Input Styling --- */
        input[type="text"],
        input[type="number"] {
            width: 100%;
            /* CSS ข้อ 2: Border, Padding, Radius */
            border: 2px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            box-sizing: border-box;
            transition: 0.3s;
            /* ให้เวลาเปลี่ยนสีนุ่มนวล */
        }

        /* CSS ข้อ 2: Focus State เปลี่ยนสี */
        input:focus {
            background-color: #f0f8ff;
            /* สีฟ้าอ่อนจางๆ */
            border-color: #007bff;
            /* สีเส้นขอบเปลี่ยนเป็นน้ำเงิน */
            outline: none;
        }

        /* --- 3. Button Styling --- */
        .btn-group {
            /* CSS ข้อ 1: จัดปุ่มชิดซ้าย-ขวา (Space Between) */
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }

        /* CSS ข้อ 3: ปุ่ม Calculate สีน้ำเงิน */
        #btn-calculate {
            background-color: #007bff;
            /* สีน้ำเงิน */
            color: white;
        }

        #btn-calculate:hover {
            background-color: #0056b3;
        }

        /* CSS ข้อ 3: ปุ่ม Clear สีเทา */
        #btn-clear {
            background-color: #6c757d;
            /* สีเทา */
            color: white;
        }

        #btn-clear:hover {
            background-color: #5a6268;
        }

        /* --- 4. Result Box --- */
        #result-box {
            /* CSS ข้อ 4: ซ่อนตั้งแต่เริ่ม */
            display: none;

            /* CSS ข้อ 4: พื้นหลังอ่อน, Border-left เข้ม, Padding, Radius */
            background-color: #e8f5e9;
            /* พื้นหลังเขียวอ่อน */
            border-left: 4px solid #2e7d32;
            /* เส้นซ้ายเขียวเข้ม */
            padding: 15px;
            border-radius: 8px;

            margin-top: 20px;
        }

        /* ตกแต่งตารางเพิ่มเติมนิดหน่อยให้อ่านง่ายใน Result Box */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 14px;
        }

        th {
            background-color: #2e7d32;
            color: white;
        }

        .pass {
            color: green;
            font-weight: bold;
        }

        .fail {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>Grade Calculator</h2>

        <div class="input-row">
            <label>ชื่อนักเรียน:</label>
            <div class="input-wrapper"><input type="text" id="stdName" placeholder="ชื่อนักเรียน"></div>
        </div>
        <div class="input-row">
            <label>รายวิชา:</label>
            <div class="input-wrapper"><input type="text" id="subject" placeholder="รายวิชา"></div>
        </div>

        <div class="input-row">
            <label>Midterm (20%):</label>
            <div class="input-wrapper"><input type="number" id="scoreMid" placeholder="0-100"></div>
        </div>
        <div class="input-row">
            <label>Final (50%):</label>
            <div class="input-wrapper"><input type="number" id="scoreFin" placeholder="0-100"></div>
        </div>
        <div class="input-row">
            <label>Assignment (30%):</label>
            <div class="input-wrapper"><input type="number" id="scoreAss" placeholder="0-100"></div>
        </div>

        <div class="btn-group">
            <button id="btn-calculate" >Calculate</button>
            <button id="btn-clear" >Clear</button>
            <button onclick="clearAllData()" style="background-color: #dc3545; color: white;">ล้างประวัติทั้งหมด</button>
        </div>

        <div id="result-box">
            <h3 style="margin-top:0;">ผลลัพธ์การเรียน</h3>
            <table id="resultTable">
                <thead>
                    <tr>
                        <th>ชื่อ</th>
                        <th>วิชา</th>
                        <th>รวม</th>
                        <th>เกรด</th>
                        <th>สถานะ</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <script>
        function validateScore(score) {
                // 1. เช็คค่าว่าง (Empty String)
                // ต้องดักก่อน เพราะ Number("") จะได้ 0 ซึ่งอาจจะทำให้ผ่านเงื่อนไข >= 0 ได้
                if (score === "") {
                    return false;
                }

                // 2. แปลงเป็นตัวเลข
                let num = Number(score);

                // 3. ตรวจสอบเงื่อนไขพร้อมกัน
                // !isNaN(num)  -> ต้องไม่ใช่ NaN (เช่น "abc" แปลงแล้วได้ NaN)
                // num >= 0     -> ต้องมากกว่าหรือเท่ากับ 0
                // num <= 100   -> ต้องน้อยกว่าหรือเท่ากับ 100
                if (!isNaN(num) && num >= 0 && num <= 100) {
                    return true;
                }

                // ถ้าไม่ผ่านเงื่อนไขข้างบนเลย ให้ return false
                return false;
            }
            function calculateScore(midterm, final, assignment) {
                    // แปลงค่า input เป็นตัวเลขก่อนคำนวณ (เพื่อความชัวร์)
                    let m = Number(midterm);
                    let f = Number(final);
                    let a = Number(assignment);

                    // คำนวณตามสูตร: (Midterm × 0.2) + (Final × 0.5) + (Assignment × 0.3)
                    let totalScore = (m * 0.20) + (f * 0.50) + (a * 0.30);

                    return totalScore;
                }
            function getGrade(score) {
                    // แปลงค่าเป็นตัวเลขเพื่อให้แน่ใจ (เผื่อส่งมาเป็น string)
                    let s = Number(score);

                    if (s >= 80) {
                        return "A";
                    } else if (s >= 70) {
                        return "B";
                    } else if (s >= 60) {
                        return "C";
                    } else if (s >= 50) {
                        return "D";
                    } else {
                        return "F";
                    }
                }
                function getStatus(grade) {
                        if (grade === 'F') {
                            return "FAIL";
                        } else {
                            return "PASS";
                        }
                    }
                    // ต้องใช้ Key ชื่อเดียวกันเป๊ะๆ ในที่นี้คือ "studentData"

                        function loadFromStorage() {
                            let jsonStr = localStorage.getItem('studentData'); // 1. ชื่อ Key ต้องตรง
                            if (jsonStr) {
                                return JSON.parse(jsonStr); // 2. ต้องแปลง String เป็น Array
                            } else {
                                return null;
                            }
                        }

                        function saveToStorage(data) {
                            let list = loadFromStorage(); // 3. โหลดของเก่ามาก่อน

                            if (list === null) {
                                list = []; // 4. ถ้าไม่มีของเก่า ให้สร้าง Array ว่าง
                            }

                            list.push(data); // 5. ยัดข้อมูลใส่ต่อท้าย (ห้ามใช้ = data เฉยๆ)

                            localStorage.setItem("studentData", JSON.stringify(list)); // 6. ชื่อ Key ต้องตรง
                        }
                        function handleCalculate() {
                                // 1. รับค่าจาก Input (รับมาเป็น String ก่อนเพื่อส่งไป validate)
                                let name = document.getElementById("stdName").value.trim();
                                let subject = document.getElementById("subject").value.trim();
                                let midStr = document.getElementById("scoreMid").value;
                                let finStr = document.getElementById("scoreFin").value;
                                let assStr = document.getElementById("scoreAss").value;

                                // 2. Validate: ชื่อและวิชา (ต้องไม่ว่าง)
                                if (name === "" || subject === "") {
                                    alert("Please enter student name and subject");
                                    return;
                                }

                                // 3. Validate: คะแนน (เรียกใช้ validateScore ที่คุณเขียนไว้)
                                // ฟังก์ชัน validateScore เช็คทั้ง "ค่าว่าง", "ไม่ใช่ตัวเลข", และ "ช่วง 0-100" ให้แล้ว
                                if (!validateScore(midStr) || !validateScore(finStr) || !validateScore(assStr)) {
                                    alert("Please enter valid numbers between 0-100");
                                    return;
                                }

                                // 4. แปลงเป็นตัวเลขจริง (เพื่อใช้คำนวณและบันทึก)
                                let m = Number(midStr);
                                let f = Number(finStr);
                                let a = Number(assStr);

                                // 5. คำนวณคะแนนรวม (เรียกใช้ calculateScore)
                                let total = calculateScore(m, f, a);

                                // 6. หาเกรดและสถานะ (เรียกใช้ getGrade และ getStatus)
                                let grade = getGrade(total);
                                let status = getStatus(grade);

                                // 7. เตรียมข้อมูล Object (JSON)
                                // เพิ่ม field midterm, final, assignment เพื่อให้ข้อมูลครบถ้วน
                                let data = {
                                    name: name,
                                    subject: subject,
                                    midterm: m,
                                    final: f,
                                    assignment: a,
                                    score: Number(total.toFixed(2)), // ปัดทศนิยม 2 ตำแหน่งและแปลงกลับเป็น Number
                                    grade: grade,
                                    status: status,
                                    statusClass: (status === "PASS") ? "pass" : "fail" // เตรียม class สำหรับ CSS
                                };

                               renderRowHelper(data);

                            // สั่งเปิดกล่อง Result ให้มองเห็น (เผื่อเดิมมันซ่อนอยู่)
                            document.getElementById("result-box").style.display = "block";

                                // 9. บันทึกลง Storage (เรียกใช้ saveToStorage ที่คุณเขียนไว้)
                                saveToStorage(data);
                            }
                            function clearAllData() {
                                    // ถามยืนยันก่อนลบ เพื่อป้องกันการกดพลาด
                                    if (confirm("คุณต้องการลบประวัติผลการเรียนทั้งหมดหรือไม่?")) {
                                        // 1. ลบข้อมูลใน Storage
                                        localStorage.removeItem("studentData");

                                        // 2. รีเฟรชหน้าจอเพื่อเริ่มใหม่
                                        location.reload();
                                    }
                                }
                            function handleClear() {
                                    // 1. Clear ทุก input fields
                                    document.getElementById("stdName").value = "";
                                    document.getElementById("subject").value = "";
                                    document.getElementById("scoreMid").value = "";
                                    document.getElementById("scoreFin").value = "";
                                    document.getElementById("scoreAss").value = "";

                                    // 2. ซ่อน result section
                                    document.getElementById("result-box").style.display = "none";

                                    // (Optional) แถม: ย้ายเคอร์เซอร์ไปรอที่ช่อง "ชื่อ" เพื่อให้เริ่มกรอกใหม่ได้เลย
                                    document.getElementById("stdName").focus();
                                }
                                function renderRowHelper(item) {
                                        let tbody = document.querySelector("#resultTable tbody");
                                        if (tbody.innerHTML.includes("No data.")) tbody.innerHTML = "";

                                        let row = tbody.insertRow();
                                        row.innerHTML = `<td>${item.name}</td><td>${item.subject}</td><td>${item.score}</td><td>${item.grade}</td><td class="${item.statusClass}">${item.status}</td>`;
                                    }
                                window.addEventListener("DOMContentLoaded", () => {
                                        // 1. Load data
                                        const students = loadFromStorage();
                                        const tbody = document.querySelector("#resultTable tbody");
                                        const resultBox = document.getElementById("result-box");

                                        // 2. ถ้ามีข้อมูล ให้แสดงด้วย .map()
                                        if (students && students.length > 0) {
                                            const rows = students.map(student => {
                                                // ใช้ค่า statusClass ที่ save ไว้ หรือคำนวณใหม่ถ้าไม่มี
                                                const sClass = student.statusClass || ((student.status === "PASS") ? "pass" : "fail");

                                                return `
                        <tr>
                            <td>${student.name}</td>
                            <td>${student.subject}</td>
                            <td>${student.score}</td>
                            <td>${student.grade}</td>
                            <td class="${sClass}">${student.status}</td>
                        </tr>
                    `;
                                            }).join("");

                                            tbody.innerHTML = rows;
                                            resultBox.style.display = "block";
                                        } else {
                                            // 3. ถ้าไม่มี -> แสดง No data
                                            tbody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:gray;">No data.</td></tr>`;
                                            // ซ่อน result box ดีกว่าถ้าไม่มีข้อมูล (หรือจะเปิดไว้ก็ได้แล้วแต่ดีไซน์)
                                            // resultBox.style.display = "block"; 
                                        }
                                    document.getElementById("btn-calculate").addEventListener("click", handleCalculate);
                                    document.getElementById("btn-clear").addEventListener("click", handleClear);
                                
                                    });
                                    

    </script>   
</body>

</html>